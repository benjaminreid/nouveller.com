// Generated by CoffeeScript 1.4.0
(function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,t){this.status=e;this.text=t!=null?t:"";this.el=$("<li />");this.setup()}e.prototype.setup=function(){this.setStatus();this.status==="sending"&&this.setPrompt();this.setText();if(this.status==="sending")return this.setBlink()};e.prototype.setStatus=function(){return this.el.addClass("t-message-"+this.status)};e.prototype.setText=function(){var e;e=$("<span />");e.addClass("terminal-message");e.html(this.text);this.el.append(e);return this.message=e};e.prototype.setPrompt=function(){var e;e=$("<span />");e.addClass("terminal-prompt");e.html("&gt;");return this.el.append(e)};e.prototype.setBlink=function(){var e,t,n=this;e=$("<span />");e.addClass("terminal-blinker");this.el.append(e);t=function(){return e.toggleClass("terminal-blink")};return this.interval=setInterval(t,500)};e.prototype.keyReceived=function(e){var t,n,r;if(e.keyCode===8){r=this.message.text();n=r.substring(0,r.length-1);return this.message.html(n)}t=String.fromCharCode(e.keyCode).toLowerCase();e.keyCode===32&&(t="&nbsp;");return this.message.append(t)};e.prototype.getMessage=function(){return this.message.text().toLowerCase()};e.prototype.setMessage=function(e){return this.message.text(e)};e.prototype.disable=function(){this.el.addClass("t-message-disable");return this.interval=clearInterval(this.interval)};e.prototype.get=function(){return this.el};return e}();t=function(){function t(e,t){this.parent=e;this.responses=t;this.typed=n(this.typed,this);this.listen=!1;this.clearHistory()}t.prototype.init=function(){this.getElements();return this.attachEvents()};t.prototype.getElements=function(){return this.elements={parent:this.parent,output:this.parent.find(".terminal-output"),body:$(document.body)}};t.prototype.attachEvents=function(){var e=this;return this.elements.body.on("keydown",function(t){if(e.listen)return e.typed(t)})};t.prototype.typed=function(e){var t;e.keyCode===32&&e.preventDefault();e.keyCode===8&&e.preventDefault();if(e.keyCode===13){t=this.current.getMessage();return this.handleMessage(t)}return e.keyCode===38?this.historyLookup():this.current.keyReceived(e)};t.prototype.message=function(t,n){var r;r=new e(t,n);this.elements.output.append(r.get());this.current=r;return this.listen=t==="sending"?!0:!1};t.prototype.handleMessage=function(e){var t;this.listen=!1;this.current.disable();t=e.replace(/\s+/g,"");this.responses[t]?this.responses[t].call():this.responses["default"].call();return this.addHistory(e)};t.prototype.historyLookup=function(){var e;if(this.sentMessages.length&&this.messagePos!==0){this.messagePos--;e=this.sentMessages[this.messagePos];return this.current.setMessage(e)}};t.prototype.addHistory=function(e){this.sentMessages.push(e);return this.messagePos=this.sentMessages.length};t.prototype.clearHistory=function(){this.sentMessages=["help"];return this.messagePos=1};return t}();window.JP.Terminal=t}).call(this);